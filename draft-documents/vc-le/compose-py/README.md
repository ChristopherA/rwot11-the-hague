This is pretty messy/hacky copypasta right now as we are getting things working

The main thing of interest is how to use the new context 
